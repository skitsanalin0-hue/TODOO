<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Intent-Based Daily Planner</title><!-- Canva SDKs - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Canva ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô --> <!-- <script src="/_sdk/data_sdk.js"></script> --> <!-- <script src="/_sdk/element_sdk.js"></script> --> <!-- Mock SDKs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ö‡∏ô‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå -->
  <script>
    // Mock Data SDK ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå
    if (!window.dataSdk) {
      let mockData = JSON.parse(localStorage.getItem('mockTasks') || '[]');
      
      window.dataSdk = {
        async init(handler) {
          this.handler = handler;
          handler.onDataChanged(mockData);
          return { isOk: true, isError: false };
        },
        async create(record) {
          const newRecord = {
            ...record,
            __backendId: 'mock_' + Date.now() + '_' + Math.random()
          };
          mockData.push(newRecord);
          localStorage.setItem('mockTasks', JSON.stringify(mockData));
          if (this.handler) this.handler.onDataChanged(mockData);
          return { isOk: true, isError: false };
        },
        async update(record) {
          const index = mockData.findIndex(t => t.__backendId === record.__backendId);
          if (index !== -1) {
            mockData[index] = record;
            localStorage.setItem('mockTasks', JSON.stringify(mockData));
            if (this.handler) this.handler.onDataChanged(mockData);
          }
          return { isOk: true, isError: false };
        },
        async delete(record) {
          mockData = mockData.filter(t => t.__backendId !== record.__backendId);
          localStorage.setItem('mockTasks', JSON.stringify(mockData));
          if (this.handler) this.handler.onDataChanged(mockData);
          return { isOk: true, isError: false };
        }
      };
    }
    
    // Mock Element SDK ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå
    if (!window.elementSdk) {
      let mockConfig = {};
      let mockElement = null;
      
      window.elementSdk = {
        config: mockConfig,
        init(element) {
          mockElement = element;
          this.config = { ...element.defaultConfig };
          if (element.onConfigChange) {
            element.onConfigChange(this.config);
          }
        },
        async setConfig(partialConfig) {
          this.config = { ...this.config, ...partialConfig };
          if (mockElement && mockElement.onConfigChange) {
            await mockElement.onConfigChange(this.config);
          }
        }
      };
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    * {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }
    
    .task-card {
      transition: all 0.2s ease;
    }
    
    .task-card:active {
      transform: scale(0.98);
    }
    
    .btn-primary {
      transition: all 0.2s ease;
    }
    
    .btn-primary:active {
      transform: scale(0.95);
    }
    
    .energy-badge {
      transition: all 0.2s ease;
    }
    
    .priority-star {
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.05); }
    }
    
    .toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 16px 24px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      z-index: 1000;
      animation: toastIn 0.3s ease;
      min-width: 200px;
      text-align: center;
    }
    
    @keyframes toastIn {
      from {
        opacity: 0;
        transform: translate(-50%, -40%);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%);
      }
    }
    
    .modal-backdrop {
      animation: fadeIn 0.2s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .modal-content {
      animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .celebration-card {
      animation: celebrationPop 0.5s ease;
    }

    @keyframes celebrationPop {
      0% {
        transform: scale(0.8);
        opacity: 0;
      }
      50% {
        transform: scale(1.05);
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .confetti {
      animation: confettiFall 3s ease-out;
    }

    @keyframes confettiFall {
      0% {
        transform: translateY(-100px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }

    .date-nav-btn {
      transition: all 0.2s ease;
    }

    .date-nav-btn:active {
      transform: scale(0.9);
    }

    .pixel-bg {
      position: relative;
      overflow: hidden;
    }

    .pixel-bg::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        linear-gradient(0deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent),
        linear-gradient(90deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent);
      background-size: 50px 50px;
      pointer-events: none;
      z-index: 1;
    }

    .pixel-character {
      position: fixed;
      font-size: 40px;
      animation: float 3s ease-in-out infinite;
      z-index: 0;
      opacity: 0.15;
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }

    .pixel-character:nth-child(1) { top: 10%; left: 5%; animation-delay: 0s; animation-duration: 4s; }
    .pixel-character:nth-child(2) { top: 25%; right: 8%; animation-delay: 0.5s; animation-duration: 3.5s; }
    .pixel-character:nth-child(3) { top: 45%; left: 10%; animation-delay: 1s; animation-duration: 4.5s; }
    .pixel-character:nth-child(4) { top: 60%; right: 5%; animation-delay: 1.5s; animation-duration: 3s; }
    .pixel-character:nth-child(5) { top: 75%; left: 15%; animation-delay: 2s; animation-duration: 4s; }
    .pixel-character:nth-child(6) { top: 15%; left: 50%; animation-delay: 0.8s; animation-duration: 3.8s; }
    .pixel-character:nth-child(7) { top: 85%; right: 20%; animation-delay: 1.2s; animation-duration: 4.2s; }
    .pixel-character:nth-child(8) { top: 35%; right: 25%; animation-delay: 1.8s; animation-duration: 3.3s; }

    .content-layer {
      position: relative;
      z-index: 2;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="w-full h-full overflow-auto"></div>
  <script>
    const defaultConfig = {
      background_color: "#fafafa",
      surface_color: "#ffffff",
      text_color: "#1a1a1a",
      primary_action_color: "#6366f1",
      secondary_action_color: "#8b5cf6",
      font_family: "Inter",
      font_size: 15,
      app_title: "Intent Planner",
      priority_section_title: "Today's Top Priorities",
      tasks_section_title: "All Tasks",
      add_task_button: "+ Add Task",
      empty_state_text: "Start adding your tasks"
    };

    const priorityLevels = [
      { value: 1, label: '1. ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç-‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô', icon: 'üî¥', color: '#ef4444' },
      { value: 2, label: '2. ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç-‡πÑ‡∏°‡πà‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô', icon: 'üü†', color: '#f97316' },
      { value: 3, label: '3. ‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç-‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô', icon: 'üü°', color: '#eab308' },
      { value: 4, label: '4. ‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç-‡πÑ‡∏°‡πà‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô', icon: 'üü¢', color: '#22c55e' }
    ];

    const timeSlots = [
      { value: 'anytime', label: 'Anytime' },
      { value: 'morning', label: 'üåÖ Morning (6:00-12:00)' },
      { value: 'afternoon', label: '‚òÄÔ∏è Afternoon (12:00-18:00)' },
      { value: 'evening', label: 'üåÜ Evening (18:00-22:00)' },
      { value: 'night', label: 'üåô Night (22:00-6:00)' }
    ];

    let tasks = [];
    let editingTask = null;
    let isAddingTask = false;
    let isCalendarOpen = false;
    let currentDate = new Date();
    currentDate.setHours(0, 0, 0, 0);

    function getPriorityLevel(level) {
      return priorityLevels.find(p => p.value === level) || priorityLevels[3];
    }

    function getPriorityBadge(level) {
      const priority = getPriorityLevel(level);
      const config = window.elementSdk?.config || defaultConfig;
      return `
        <span class="inline-flex items-center gap-1 px-2 py-1 rounded-lg text-xs font-medium" style="background: ${priority.color}15; color: ${priority.color};">
          <span>${priority.icon}</span>
          <span>‡∏£‡∏∞‡∏î‡∏±‡∏ö ${priority.value}</span>
        </span>
      `;
    }

    const dataHandler = {
      onDataChanged(data) {
        tasks = data || [];
        renderApp();
      }
    };

    window.changeDate = function(direction) {
      const newDate = new Date(currentDate);
      newDate.setDate(newDate.getDate() + direction);
      currentDate = newDate;
      renderApp();
    };

    window.goToToday = function() {
      currentDate = new Date();
      currentDate.setHours(0, 0, 0, 0);
      renderApp();
    };

    window.openCalendar = function() {
      isCalendarOpen = true;
      renderApp();
    };

    window.closeCalendar = function() {
      isCalendarOpen = false;
      renderApp();
    };

    window.selectCalendarDate = function(year, month, day) {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const selected = new Date(year, month, day);
      selected.setHours(0, 0, 0, 0);
      
      if (selected < today) {
        showToast('Cannot select past dates', 'warning');
        return;
      }
      
      currentDate = selected;
      closeCalendar();
    };

    function generateCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startingDayOfWeek = firstDay.getDay();
      const totalDays = lastDay.getDate();
      
      const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                          'July', 'August', 'September', 'October', 'November', 'December'];
      
      let calendar = [];
      let week = [];
      
      for (let i = 0; i < startingDayOfWeek; i++) {
        week.push(null);
      }
      
      for (let day = 1; day <= totalDays; day++) {
        const date = new Date(year, month, day);
        date.setHours(0, 0, 0, 0);
        const isPast = date < today;
        const isSelected = isSameDay(date, currentDate);
        const isToday = isSameDay(date, today);
        
        week.push({ day, isPast, isSelected, isToday, date });
        
        if (week.length === 7) {
          calendar.push(week);
          week = [];
        }
      }
      
      if (week.length > 0) {
        while (week.length < 7) {
          week.push(null);
        }
        calendar.push(week);
      }
      
      return {
        monthName: monthNames[month],
        year: year,
        weeks: calendar
      };
    }

    window.changeCalendarMonth = function(direction) {
      const newDate = new Date(currentDate);
      newDate.setMonth(newDate.getMonth() + direction);
      currentDate = newDate;
      renderApp();
    };

    function isSameDay(date1, date2) {
      return date1.getFullYear() === date2.getFullYear() &&
             date1.getMonth() === date2.getMonth() &&
             date1.getDate() === date2.getDate();
    }

    function isToday(date) {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      return isSameDay(date, today);
    }

    function getTasksForDate(date) {
      return tasks.filter(task => {
        const taskDate = new Date(task.created_at);
        taskDate.setHours(0, 0, 0, 0);
        return isSameDay(taskDate, date);
      }).sort((a, b) => {
        return (a.priority_level || 4) - (b.priority_level || 4);
      });
    }

    function getEnergyIcon(level) {
      const icons = {
        high: 'üî•',
        medium: '‚ö°',
        low: 'üå±'
      };
      return icons[level] || 'üå±';
    }

    function getEnergyColor(level) {
      const colors = {
        high: '#ef4444',
        medium: '#f59e0b',
        low: '#10b981'
      };
      return colors[level] || '#gray';
    }

    function getEnergyLabel(level) {
      const labels = {
        high: 'High Energy',
        medium: 'Medium',
        low: 'Low Energy'
      };
      return labels[level] || 'Not specified';
    }

    function getTimeSlotLabel(slot) {
      const timeSlot = timeSlots.find(ts => ts.value === slot);
      return timeSlot ? timeSlot.label : 'Anytime';
    }

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.style.background = type === 'success' ? '#10b981' : type === 'warning' ? '#f59e0b' : '#ef4444';
      toast.style.color = '#ffffff';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = 'toastIn 0.3s ease reverse';
        setTimeout(() => toast.remove(), 300);
      }, 2000);
    }

    function showCelebration() {
      const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#a8e6cf', '#ff8b94'];
      
      for (let i = 0; i < 30; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.position = 'fixed';
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.top = '-50px';
          confetti.style.width = '10px';
          confetti.style.height = '10px';
          confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
          confetti.style.zIndex = '9999';
          confetti.style.pointerEvents = 'none';
          document.body.appendChild(confetti);
          
          setTimeout(() => confetti.remove(), 3000);
        }, i * 100);
      }
    }

    window.addTask = async function(taskData) {
      const selectedDate = taskData.task_date;
      const tasksForSelectedDate = getTasksForDate(selectedDate);
      const priorityCount = tasksForSelectedDate.filter(t => t.is_priority && t.status !== 'completed').length;
      
      if (taskData.is_priority && priorityCount >= 3) {
        showToast('This day already has 3 priority tasks', 'warning');
        return;
      }

      if (tasks.length >= 999) {
        showToast('Maximum limit of 999 tasks reached', 'error');
        return;
      }

      const newTask = {
        name: taskData.name,
        energy_level: taskData.energy_level,
        duration: taskData.duration,
        time_slot: taskData.time_slot,
        priority_level: taskData.priority_level,
        is_priority: taskData.is_priority,
        status: 'pending',
        completed_at: null,
        created_at: selectedDate.toISOString()
      };

      const submitButton = document.querySelector('form button[type="submit"]');
      if (submitButton) {
        submitButton.disabled = true;
        submitButton.innerHTML = '<span class="inline-block animate-spin mr-2">‚è≥</span> Adding...';
      }

      const result = await window.dataSdk.create(newTask);
      
      if (submitButton) {
        submitButton.disabled = false;
        submitButton.textContent = 'Add Task';
      }

      if (result.isOk) {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const isPlannedAhead = selectedDate > today;
        
        if (isPlannedAhead) {
          showToast('Task planned ahead! ÔøΩÔøΩ');
          currentDate = new Date(selectedDate);
        } else {
          showToast('Task added successfully! üéâ');
        }
        closeModal();
      } else {
        showToast('An error occurred', 'error');
      }
    };

    window.updateTaskStatus = async function(taskId, newStatus) {
      const task = tasks.find(t => t.__backendId === taskId);
      if (!task) return;

      const updatedTask = {
        ...task,
        status: newStatus,
        completed_at: newStatus === 'completed' ? new Date().toISOString() : null
      };

      const result = await window.dataSdk.update(updatedTask);
      
      if (result.isOk) {
        if (newStatus === 'completed') {
          showToast('Task completed! üéâ');
          
          const todayTasks = getTasksForDate(currentDate);
          const priorityTasks = todayTasks.filter(t => t.is_priority);
          const allPriorityCompleted = priorityTasks.length > 0 && 
                                       priorityTasks.every(t => t.status === 'completed');
          
          if (allPriorityCompleted) {
            setTimeout(() => {
              showCelebration();
              showToast('üéä Excellent! All priorities completed!');
            }, 500);
          }
        }
      } else {
        showToast('An error occurred', 'error');
      }
    };

    window.deleteTask = async function(taskId) {
      const task = tasks.find(t => t.__backendId === taskId);
      if (!task) return;

      const taskCard = document.querySelector(`[data-task-id="${taskId}"]`);
      if (taskCard) {
        const deleteBtn = taskCard.querySelector('.delete-btn');
        if (deleteBtn && !deleteBtn.dataset.confirming) {
          deleteBtn.dataset.confirming = 'true';
          deleteBtn.style.background = '#ef4444';
          deleteBtn.style.color = '#ffffff';
          deleteBtn.textContent = 'Confirm?';
          
          setTimeout(() => {
            if (deleteBtn.dataset.confirming) {
              delete deleteBtn.dataset.confirming;
              deleteBtn.style.background = '';
              deleteBtn.style.color = '';
              deleteBtn.textContent = 'üóëÔ∏è';
            }
          }, 3000);
          return;
        }
      }

      const result = await window.dataSdk.delete(task);
      
      if (result.isOk) {
        showToast('Task deleted');
      } else {
        showToast('An error occurred', 'error');
      }
    };

    window.openModal = function() {
      isAddingTask = true;
      editingTask = null;
      renderApp();
    };

    window.closeModal = function() {
      isAddingTask = false;
      editingTask = null;
      renderApp();
    };

    window.handleModalSubmit = function(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const selectedDate = new Date(formData.get('task_date') + 'T00:00:00');
      
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      selectedDate.setHours(0, 0, 0, 0);
      
      if (selectedDate < today) {
        showToast('Cannot add tasks for past dates', 'warning');
        return;
      }
      
      const taskData = {
        name: formData.get('name'),
        energy_level: formData.get('energy_level'),
        duration: parseInt(formData.get('duration')),
        time_slot: formData.get('time_slot') || 'anytime',
        priority_level: parseInt(formData.get('priority_level')) || 4,
        is_priority: formData.get('is_priority') === 'on',
        task_date: selectedDate
      };

      if (!taskData.name.trim()) {
        showToast('Please enter a task name', 'warning');
        return;
      }

      addTask(taskData);
    };

    function renderApp() {
      const config = window.elementSdk?.config || defaultConfig;
      const app = document.getElementById('app');
      
      const todayTasks = getTasksForDate(currentDate);
      const priorityTasks = todayTasks.filter(t => t.is_priority && t.status !== 'completed');
      const regularTasks = todayTasks.filter(t => !t.is_priority && t.status !== 'completed');
      const completedTasks = todayTasks.filter(t => t.status === 'completed');

      const allPriorityCompleted = priorityTasks.length === 0 && 
                                   todayTasks.filter(t => t.is_priority).length > 0;

      const totalDuration = [...priorityTasks, ...regularTasks].reduce((sum, t) => sum + (t.duration || 0), 0);
      const overloaded = totalDuration > 480;

      const dateString = currentDate.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });

      const isCurrentlyToday = isToday(currentDate);

      app.innerHTML = `
        <div class="w-full min-h-full pixel-bg" style="background: ${config.background_color || defaultConfig.background_color}; font-family: '${config.font_family || defaultConfig.font_family}', sans-serif;">
          <div class="pixel-character">‚òï</div>
          <div class="pixel-character">üìö</div>
          <div class="pixel-character">üíª</div>
          <div class="pixel-character">üèÉ</div>
          <div class="pixel-character">üçé</div>
          <div class="pixel-character">‚è∞</div>
          <div class="pixel-character">üéÆ</div>
          <div class="pixel-character">üåü</div>
          <div class="max-w-2xl mx-auto px-4 py-4 pb-20 content-layer">
            <header class="mb-4">
              <h1 class="mb-1" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.6}px; font-weight: 700; letter-spacing: -0.02em;">
                ${config.app_title || defaultConfig.app_title}
              </h1>
            </header>

            <div class="mb-6 p-3 rounded-2xl" style="background: ${config.surface_color || defaultConfig.surface_color}; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
              <div class="flex items-center justify-between gap-3">
                <button onclick="changeDate(-1)" class="date-nav-btn p-2 rounded-xl transition-all" style="background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                  </svg>
                </button>
                
                <button onclick="openCalendar()" class="flex-1 text-center py-2 px-4 rounded-xl transition-all hover:bg-opacity-50" style="background: ${config.background_color || defaultConfig.background_color};">
                  <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.95}px; font-weight: 600;">
                    üìÖ ${dateString}
                  </div>
                  ${!isCurrentlyToday ? `
                    <div class="mt-1 text-xs px-3 py-1 rounded-full inline-block" style="background: ${config.primary_action_color || defaultConfig.primary_action_color}22; color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-weight: 500;">
                      Viewing Selected Date
                    </div>
                  ` : `
                    <div class="mt-1 text-xs" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.5;">
                      Click to select date
                    </div>
                  `}
                </button>

                <button onclick="changeDate(1)" class="date-nav-btn p-2 rounded-xl transition-all" style="background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                </button>
              </div>
            </div>

            ${overloaded ? `
              <div class="mb-4 p-3 rounded-2xl flex items-start gap-3" style="background: #fef3c7; border-left: 3px solid #f59e0b;">
                <span style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.2}px;">‚ö†Ô∏è</span>
                <div style="color: #92400e; font-size: ${(config.font_size || defaultConfig.font_size) * 0.85}px; line-height: 1.4;">
                  <strong>Today is overloaded!</strong><br>
                  Total: ${Math.floor(totalDuration / 60)} hr ${totalDuration % 60} min
                </div>
              </div>
            ` : ''}

            ${allPriorityCompleted ? `
              <div class="celebration-card mb-6 p-6 rounded-2xl text-center" style="background: linear-gradient(135deg, ${config.primary_action_color || defaultConfig.primary_action_color}22 0%, ${config.secondary_action_color || defaultConfig.secondary_action_color}22 100%); border: 2px dashed ${config.primary_action_color || defaultConfig.primary_action_color};">
                <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 3}px; margin-bottom: 8px;">üéâ</div>
                <h3 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.2}px; font-weight: 700; margin-bottom: 4px;">
                  Excellent!
                </h3>
                <p style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7; font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px;">
                  You've completed all your priority tasks
                </p>
              </div>
            ` : ''}

            <section class="mb-6">
              <div class="flex items-center gap-2 mb-3">
                <span class="priority-star" style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.3}px;">‚≠ê</span>
                <h2 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.1}px; font-weight: 600;">
                  ${config.priority_section_title || defaultConfig.priority_section_title}
                </h2>
              </div>
              <div class="space-y-2">
                ${priorityTasks.length === 0 ? `
                  <div class="p-8 rounded-2xl text-center border-2 border-dashed" style="background: ${config.surface_color || defaultConfig.surface_color}22; border-color: ${config.text_color || defaultConfig.text_color}15; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.4; font-size: ${(config.font_size || defaultConfig.font_size) * 0.85}px;">
                    ${isCurrentlyToday ? 'Select your 3 most important tasks for today' : 'No priority tasks for this day'}
                  </div>
                ` : priorityTasks.map(task => `
                  <div class="task-card p-4 rounded-2xl" data-task-id="${task.__backendId}" style="background: ${config.surface_color || defaultConfig.surface_color}; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border-left: 4px solid ${getPriorityLevel(task.priority_level || 4).color};">
                    <div class="flex items-start gap-3">
                      <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 mb-2 flex-wrap">
                          ${getPriorityBadge(task.priority_level || 4)}
                          <span class="energy-badge inline-flex items-center gap-1 px-2 py-1 rounded-lg text-xs font-medium" style="background: ${getEnergyColor(task.energy_level)}15; color: ${getEnergyColor(task.energy_level)};">
                            <span style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px;">${getEnergyIcon(task.energy_level)}</span>
                            <span>${getEnergyLabel(task.energy_level)}</span>
                          </span>
                          <span class="text-xs" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.5;">
                            ${task.duration} min
                          </span>
                          ${task.time_slot && task.time_slot !== 'anytime' ? `
                            <span class="text-xs" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.5;">
                              ‚Ä¢ ${getTimeSlotLabel(task.time_slot)}
                            </span>
                          ` : ''}
                        </div>
                        <h3 class="font-medium break-words" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.95}px; line-height: 1.4;">
                          ${task.name}
                        </h3>
                      </div>
                      <div class="flex gap-1.5 flex-shrink-0">
                        <button onclick="updateTaskStatus('${task.__backendId}', 'completed')" 
                                class="btn-primary px-3 py-2 rounded-xl text-xs font-medium"
                                style="background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white;">
                          ‚úì
                        </button>
                        <button onclick="deleteTask('${task.__backendId}')" 
                                class="delete-btn px-3 py-2 rounded-xl text-xs"
                                style="background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};">
                          üóëÔ∏è
                        </button>
                      </div>
                    </div>
                  </div>
                `).join('')}
              </div>
            </section>

            <section class="mb-6">
              <div class="flex items-center justify-between mb-3">
                <h2 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.1}px; font-weight: 600;">
                  ${config.tasks_section_title || defaultConfig.tasks_section_title}
                </h2>
                <button onclick="openModal()" 
                        class="btn-primary px-4 py-2 rounded-xl font-medium text-sm"
                        style="background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white;">
                  ${config.add_task_button || defaultConfig.add_task_button}
                </button>
              </div>
              <div class="space-y-2">
                ${regularTasks.length === 0 && completedTasks.length === 0 ? `
                  <div class="p-12 rounded-2xl text-center border-2 border-dashed" style="background: ${config.surface_color || defaultConfig.surface_color}22; border-color: ${config.text_color || defaultConfig.text_color}15; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.4; font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px;">
                    ${isCurrentlyToday ? config.empty_state_text || defaultConfig.empty_state_text : 'No tasks for this day'}
                  </div>
                ` : `
                  ${regularTasks.map(task => `
                    <div class="task-card p-4 rounded-2xl" data-task-id="${task.__backendId}" style="background: ${config.surface_color || defaultConfig.surface_color}; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border-left: 4px solid ${getPriorityLevel(task.priority_level || 4).color};">
                      <div class="flex items-start gap-3">
                        <div class="flex-1 min-w-0">
                          <div class="flex items-center gap-2 mb-2 flex-wrap">
                            ${getPriorityBadge(task.priority_level || 4)}
                            <span class="energy-badge inline-flex items-center gap-1 px-2 py-1 rounded-lg text-xs font-medium" style="background: ${getEnergyColor(task.energy_level)}15; color: ${getEnergyColor(task.energy_level)};">
                              <span style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px;">${getEnergyIcon(task.energy_level)}</span>
                              <span>${getEnergyLabel(task.energy_level)}</span>
                            </span>
                            <span class="text-xs" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.5;">
                              ${task.duration} min
                            </span>
                            ${task.time_slot && task.time_slot !== 'anytime' ? `
                              <span class="text-xs" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.5;">
                                ‚Ä¢ ${getTimeSlotLabel(task.time_slot)}
                              </span>
                            ` : ''}
                          </div>
                          <h3 class="font-medium break-words" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.95}px; line-height: 1.4;">
                            ${task.name}
                          </h3>
                        </div>
                        <div class="flex gap-1.5 flex-shrink-0">
                          <button onclick="updateTaskStatus('${task.__backendId}', 'completed')" 
                                  class="btn-primary px-3 py-2 rounded-xl text-xs font-medium"
                                  style="background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white;">
                            ‚úì
                          </button>
                          <button onclick="deleteTask('${task.__backendId}')" 
                                  class="delete-btn px-3 py-2 rounded-xl text-xs"
                                  style="background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};">
                            üóëÔ∏è
                          </button>
                        </div>
                      </div>
                    </div>
                  `).join('')}
                  
                  ${completedTasks.length > 0 ? `
                    <div class="mt-6">
                      <h3 class="mb-3 flex items-center gap-2" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.6; font-size: ${(config.font_size || defaultConfig.font_size) * 0.85}px; font-weight: 600;">
                        <span>‚úì</span>
                        <span>Completed (${completedTasks.length})</span>
                      </h3>
                      <div class="space-y-2">
                        ${completedTasks.map(task => `
                          <div class="p-3 rounded-xl" style="background: ${config.surface_color || defaultConfig.surface_color}; opacity: 0.6; box-shadow: 0 1px 2px rgba(0,0,0,0.05);" data-task-id="${task.__backendId}">
                            <div class="flex items-center justify-between gap-3">
                              <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.85}px; text-decoration: line-through;">
                                ${task.name}
                              </span>
                              <button onclick="deleteTask('${task.__backendId}')" 
                                      class="delete-btn px-2 py-1 rounded-lg text-xs"
                                      style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.5;">
                                üóëÔ∏è
                              </button>
                            </div>
                          </div>
                        `).join('')}
                      </div>
                    </div>
                  ` : ''}
                `}
              </div>
            </section>
          </div>
        </div>

        ${isCalendarOpen ? `
          <div class="modal-backdrop fixed inset-0 flex items-center justify-center p-4" style="background: rgba(0,0,0,0.5); z-index: 999;" onclick="if(event.target === this) closeCalendar()">
            <div class="modal-content w-full max-w-md p-6 rounded-3xl" style="background: ${config.surface_color || defaultConfig.surface_color};" onclick="event.stopPropagation()">
              <div class="flex items-center justify-between mb-6">
                <button onclick="changeCalendarMonth(-1)" class="p-2 rounded-xl transition-all" style="background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                  </svg>
                </button>
                <h2 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.2}px; font-weight: 700;">
                  ${(() => {
                    const cal = generateCalendar();
                    return cal.monthName + ' ' + cal.year;
                  })()}
                </h2>
                <button onclick="changeCalendarMonth(1)" class="p-2 rounded-xl transition-all" style="background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                </button>
              </div>
              
              <div class="mb-4">
                <div class="grid grid-cols-7 gap-2 mb-2">
                  ${['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => `
                    <div class="text-center py-2" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.5; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600;">
                      ${day}
                    </div>
                  `).join('')}
                </div>
                
                ${(() => {
                  const cal = generateCalendar();
                  return cal.weeks.map(week => `
                    <div class="grid grid-cols-7 gap-2 mb-2">
                      ${week.map(day => {
                        if (!day) {
                          return '<div></div>';
                        }
                        
                        const year = currentDate.getFullYear();
                        const month = currentDate.getMonth();
                        
                        let buttonStyle = `background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color};`;
                        let cursorStyle = 'cursor: pointer;';
                        
                        if (day.isPast) {
                          buttonStyle = `background: transparent; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.2;`;
                          cursorStyle = 'cursor: not-allowed;';
                        } else if (day.isSelected) {
                          buttonStyle = `background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white;`;
                        } else if (day.isToday) {
                          buttonStyle = `background: ${config.primary_action_color || defaultConfig.primary_action_color}33; color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-weight: 700;`;
                        }
                        
                        const onclick = day.isPast ? '' : `onclick="selectCalendarDate(${year}, ${month}, ${day.day})"`;
                        
                        return `
                          <button ${onclick} class="p-2 rounded-xl text-center transition-all" style="${buttonStyle} ${cursorStyle} font-size: ${(config.font_size || defaultConfig.font_size) * 0.85}px;">
                            ${day.day}
                          </button>
                        `;
                      }).join('')}
                    </div>
                  `).join('');
                })()}
              </div>
              
              <div class="flex gap-3">
                <button onclick="goToToday(); closeCalendar();" class="flex-1 px-4 py-3 rounded-xl font-medium" style="background: ${config.primary_action_color || defaultConfig.primary_action_color}22; color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px;">
                  Today
                </button>
                <button onclick="closeCalendar()" class="flex-1 px-4 py-3 rounded-xl font-medium" style="background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px;">
                  Close
                </button>
              </div>
            </div>
          </div>
        ` : ''}

        ${isAddingTask ? `
          <div class="modal-backdrop fixed inset-0 flex items-center justify-center p-4" style="background: rgba(0,0,0,0.5); z-index: 999;" onclick="if(event.target === this) closeModal()">
            <div class="modal-content w-full max-w-lg p-6 rounded-3xl max-h-[90%] overflow-y-auto" style="background: ${config.surface_color || defaultConfig.surface_color};">
              <h2 class="mb-6" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.4}px; font-weight: 700;">
                Add New Task
              </h2>
              <form onsubmit="handleModalSubmit(event)" class="space-y-5">
                <div>
                  <label for="task-date" class="block mb-2" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.85}px; font-weight: 600;">
                    üìÖ Select Date
                  </label>
                  <input type="date" id="task-date" name="task_date" required 
                         class="w-full px-4 py-3 rounded-xl border outline-none transition-all"
                         style="background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; border-color: #e5e7eb; font-size: ${(config.font_size || defaultConfig.font_size) * 0.95}px;"
                         value="${currentDate.toISOString().split('T')[0]}"
                         min="${new Date().toISOString().split('T')[0]}"
                         onfocus="this.style.borderColor='${config.primary_action_color || defaultConfig.primary_action_color}'"
                         onblur="this.style.borderColor='#e5e7eb'">
                </div>

                <div>
                  <label for="task-name" class="block mb-2" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.85}px; font-weight: 600;">
                    Task Name
                  </label>
                  <input type="text" id="task-name" name="name" required 
                         class="w-full px-4 py-3 rounded-xl border outline-none transition-all"
                         style="background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; border-color: #e5e7eb; font-size: ${(config.font_size || defaultConfig.font_size) * 0.95}px;"
                         placeholder="e.g. Write report"
                         onfocus="this.style.borderColor='${config.primary_action_color || defaultConfig.primary_action_color}'"
                         onblur="this.style.borderColor='#e5e7eb'">
                </div>

                <div>
                  <label class="block mb-3" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.85}px; font-weight: 600;">
                    Energy Level Required
                  </label>
                  <div class="grid grid-cols-3 gap-2">
                    <label class="cursor-pointer">
                      <input type="radio" name="energy_level" value="high" required class="hidden peer">
                      <div class="p-3 rounded-xl text-center border-2 transition-all peer-checked:border-red-500 peer-checked:bg-red-50" style="border-color: #e5e7eb;">
                        <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.8}px;">üî•</div>
                        <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; margin-top: 4px; font-weight: 500;">High</div>
                      </div>
                    </label>
                    <label class="cursor-pointer">
                      <input type="radio" name="energy_level" value="medium" class="hidden peer">
                      <div class="p-3 rounded-xl text-center border-2 transition-all peer-checked:border-orange-500 peer-checked:bg-orange-50" style="border-color: #e5e7eb;">
                        <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.8}px;">‚ö°</div>
                        <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; margin-top: 4px; font-weight: 500;">Medium</div>
                      </div>
                    </label>
                    <label class="cursor-pointer">
                      <input type="radio" name="energy_level" value="low" class="hidden peer">
                      <div class="p-3 rounded-xl text-center border-2 transition-all peer-checked:border-green-500 peer-checked:bg-green-50" style="border-color: #e5e7eb;">
                        <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.8}px;">üå±</div>
                        <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; margin-top: 4px; font-weight: 500;">Low</div>
                      </div>
                    </label>
                  </div>
                </div>

                <div>
                  <label for="task-duration" class="block mb-2" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.85}px; font-weight: 600;">
                    Duration (minutes)
                  </label>
                  <input type="number" id="task-duration" name="duration" required min="5" max="480" value="30"
                         class="w-full px-4 py-3 rounded-xl border outline-none transition-all"
                         style="background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; border-color: #e5e7eb; font-size: ${(config.font_size || defaultConfig.font_size) * 0.95}px;"
                         onfocus="this.style.borderColor='${config.primary_action_color || defaultConfig.primary_action_color}'"
                         onblur="this.style.borderColor='#e5e7eb'">
                </div>

                <div>
                  <label for="time-slot" class="block mb-2" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.85}px; font-weight: 600;">
                    ‚è∞ Preferred Time
                  </label>
                  <select id="time-slot" name="time_slot"
                          class="w-full px-4 py-3 rounded-xl border outline-none transition-all cursor-pointer"
                          style="background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; border-color: #e5e7eb; font-size: ${(config.font_size || defaultConfig.font_size) * 0.95}px;"
                          onfocus="this.style.borderColor='${config.primary_action_color || defaultConfig.primary_action_color}'"
                          onblur="this.style.borderColor='#e5e7eb'">
                    ${timeSlots.map(slot => `
                      <option value="${slot.value}">${slot.label}</option>
                    `).join('')}
                  </select>
                </div>

                <div>
                  <label class="block mb-3" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.85}px; font-weight: 600;">
                    üìä ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥ÔøΩÔøΩ‡∏±‡∏ç-‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô
                  </label>
                  <div class="grid grid-cols-1 gap-2">
                    ${priorityLevels.map((level, index) => `
                      <label class="cursor-pointer">
                        <input type="radio" name="priority_level" value="${level.value}" ${index === 3 ? 'checked' : ''} ${index === 0 ? 'required' : ''} class="hidden peer">
                        <div class="p-3 rounded-xl border-2 transition-all peer-checked:shadow-lg" style="border-color: #e5e7eb; background: ${config.background_color || defaultConfig.background_color};" 
                             onmouseover="this.style.borderColor='${level.color}'; this.style.background='${level.color}11';" 
                             onmouseout="const input = this.previousElementSibling; if(!input.checked) { this.style.borderColor='#e5e7eb'; this.style.background='${config.background_color || defaultConfig.background_color}'; }">
                          <div class="flex items-center gap-3">
                            <span style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px;">${level.icon}</span>
                            <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px; font-weight: 500;">${level.label}</span>
                          </div>
                        </div>
                      </label>
                    `).join('')}
                  </div>
                </div>

                <div class="flex items-center gap-3 p-4 rounded-xl" style="background: ${config.background_color || defaultConfig.background_color};">
                  <input type="checkbox" id="is-priority" name="is_priority" class="w-5 h-5 rounded cursor-pointer" style="accent-color: ${config.primary_action_color || defaultConfig.primary_action_color};">
                  <label for="is-priority" class="cursor-pointer flex-1" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px; font-weight: 500;">
                    ‚≠ê Make this a Top 3 Priority
                  </label>
                </div>

                <div class="flex gap-3 pt-2">
                  <button type="button" onclick="closeModal()" 
                          class="flex-1 px-6 py-3 rounded-xl font-medium transition-all"
                          style="background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px;">
                    Cancel
                  </button>
                  <button type="submit" 
                          class="btn-primary flex-1 px-6 py-3 rounded-xl font-medium"
                          style="background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px;">
                    Add Task
                  </button>
                </div>
              </form>
            </div>
          </div>
        ` : ''}
      `;
    }

    // ============================================================
    // ELEMENT SDK CONFIGURATION
    // ============================================================
    
    async function onConfigChange(config) {
      renderApp();
    }

    const capabilities = {
      recolorables: [
        {
          get: () => window.elementSdk.config.background_color || defaultConfig.background_color,
          set: (value) => {
            window.elementSdk.config.background_color = value;
            window.elementSdk.setConfig({ background_color: value });
          }
        },
        {
          get: () => window.elementSdk.config.surface_color || defaultConfig.surface_color,
          set: (value) => {
            window.elementSdk.config.surface_color = value;
            window.elementSdk.setConfig({ surface_color: value });
          }
        },
        {
          get: () => window.elementSdk.config.text_color || defaultConfig.text_color,
          set: (value) => {
            window.elementSdk.config.text_color = value;
            window.elementSdk.setConfig({ text_color: value });
          }
        },
        {
          get: () => window.elementSdk.config.primary_action_color || defaultConfig.primary_action_color,
          set: (value) => {
            window.elementSdk.config.primary_action_color = value;
            window.elementSdk.setConfig({ primary_action_color: value });
          }
        },
        {
          get: () => window.elementSdk.config.secondary_action_color || defaultConfig.secondary_action_color,
          set: (value) => {
            window.elementSdk.config.secondary_action_color = value;
            window.elementSdk.setConfig({ secondary_action_color: value });
          }
        }
      ],
      borderables: [],
      fontEditable: {
        get: () => window.elementSdk.config.font_family || defaultConfig.font_family,
        set: (value) => {
          window.elementSdk.config.font_family = value;
          window.elementSdk.setConfig({ font_family: value });
        }
      },
      fontSizeable: {
        get: () => window.elementSdk.config.font_size || defaultConfig.font_size,
        set: (value) => {
          window.elementSdk.config.font_size = value;
          window.elementSdk.setConfig({ font_size: value });
        }
      }
    };

    function mapToEditPanelValues(config) {
      return new Map([
        ["app_title", config.app_title || defaultConfig.app_title],
        ["priority_section_title", config.priority_section_title || defaultConfig.priority_section_title],
        ["tasks_section_title", config.tasks_section_title || defaultConfig.tasks_section_title],
        ["add_task_button", config.add_task_button || defaultConfig.add_task_button],
        ["empty_state_text", config.empty_state_text || defaultConfig.empty_state_text]
      ]);
    }

    // ============================================================
    // APP INITIALIZATION
    // ============================================================
    
    async function initializeApp() {
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: () => capabilities,
          mapToEditPanelValues
        });
      }

      if (window.dataSdk) {
        const initResult = await window.dataSdk.init(dataHandler);
        if (!initResult.isOk) {
          showToast('Failed to load data', 'error');
        }
      }
    }

    initializeApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9aedac35f60ad014',t:'MTc2NTg4Mjc4MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>